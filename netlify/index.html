<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Підключення гаманця Solana</title>
</head>
<body>
    <h2>Підключення гаманця Solana</h2>
    <button id="connectWalletBtn">Підключити гаманець</button>
    <p id="walletStatus">Статус: не підключено</p>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const connectWalletBtn = document.getElementById("connectWalletBtn");
            const walletStatus = document.getElementById("walletStatus");

            async function connectWallet(autoConnect = false) {
                if (window.solana && window.solana.isPhantom) {
                    try {
                        const response = await window.solana.connect({ onlyIfTrusted: autoConnect });
                        localStorage.setItem("phantomWallet", response.publicKey.toString());
                        walletStatus.textContent = `Connected: ${response.publicKey.toString()}`;
                        connectWalletBtn.textContent = "Wallet Connected";
                        connectWalletBtn.disabled = true;
                        console.log("✅ Wallet connected:", response.publicKey.toString());
                    } catch (err) {
                        console.error("❌ Connection failed:", err);
                        walletStatus.textContent = "Connection failed!";
                        localStorage.removeItem("phantomWallet");
                    }
                } else if (window.solflare) {
                    try {
                        const solflare = new window.Solflare();
                        await solflare.connect();
                        if (solflare.publicKey) {
                            localStorage.setItem("solflareWallet", solflare.publicKey.toString());
                            walletStatus.textContent = `Connected: ${solflare.publicKey.toString()}`;
                            connectWalletBtn.textContent = "Wallet Connected";
                            connectWalletBtn.disabled = true;
                            console.log("✅ Solflare Wallet connected:", solflare.publicKey.toString());
                        }
                    } catch (err) {
                        console.error("❌ Solflare connection failed:", err);
                        walletStatus.textContent = "Solflare connection failed!";
                    }
                } else {
                    console.log("⚠️ Гаманець не знайдено. Відкриваємо додаток...");
                    if (/Android|iPhone/i.test(navigator.userAgent)) {
                        const deeplink = `https://phantom.app/ul/v1/connect?app_url=${encodeURIComponent("https://cool-kataifi-90a5d5.netlify.app")}&dapp_encryption_public_key=&cluster=mainnet-beta&redirect_link=${encodeURIComponent(window.location.href)}`;
                        window.location.href = deeplink;
                    } else {
                        alert("Встановіть Phantom або Solflare.");
                        window.open("https://phantom.app/", "_blank");
                    }
                }
            }

            async function checkAutoConnect() {
                const savedWallet = localStorage.getItem("phantomWallet") || localStorage.getItem("solflareWallet");
                if (savedWallet) {
                    await connectWallet(true);
                }
            }

            connectWalletBtn.addEventListener("click", () => connectWallet(false));
            checkAutoConnect();
        });
    </script>
</body>
</html>

